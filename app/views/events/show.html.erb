<div class = 'container'>
  <div class = 'row well'>
    <h1><%= @event.name %></h1>
    <div class = "col-md-3">
      <h3>Event Details</h3>
      <p>
        <%= @event.event_type %> Event<br/>
        Status: <%= @event.status.capitalize %><br/>
        Date: <%= @event.date %><br/>
        Time: <%= @event.time %><br/>
        Matches: <%= @event.num_matches %>
      </p>
      <% if user_signed_in? %>
        <!-- If user owns the team they can remove them from the event -->
        <% if @event.status == "open" and @captain %>
          <%= form_for @event, url: event_path(id: @event.id), :html => { :multipart => true } do |f| %>
            <%= f.hidden_field :team_id, :value => current_user.profile.team_id %>
            <%= f.hidden_field :msg, :value => "join" %>
            <%= submit_tag( "Sign Up", class: "btn btn-info text-center" ) %>
          <% end %>
        <% end %>
        <% if current_user.user_type == "admin" %>
          <%= form_for @event, url: event_path(id: @event.id), :html => { :multipart => true } do |f| %>
            <%= f.hidden_field :msg, :value => "close" %>
            <%= submit_tag( "Toggle Event", class: "btn btn-warning text-center" ) %>
          <% end %>
          <br/>
          <button type="button" class="btn btn-info" data-toggle="modal" data-target="#match_modal">Create Match</button>
        <% end %>
      <% end %>
    </div>
    <div class = "col-md-9">
      <h3>Teams</h3>
      <% @teams.each do |t| %>
        
        <div class = "row">
          <div class = "col-md-6">
            <%= link_to team_path(id: t.id) do %>
            <%= image_tag t.avatar.url, class: 'user-index-avatar'%>
            &emsp;<%= t.name %>
            <% end %>
          </div>
          <div class = "col-md-4">
            
          </div>
          
          <div class = "col-md-4">
            <% if @event.status == "open" %>
              <% if user_signed_in? %>
               <!-- If user owns the team they can remove them from the event -->
                <% if (t.user_id == current_user.id) || (current_user.user_type == "admin") %>
                  <%= form_for @event, url: event_path(id: @event.id), :html => { :multipart => true } do |f| %>
                    <%= f.hidden_field :msg, :value => "leave" %>
                    <%= f.hidden_field :team_id, :value => t.id %>
                    <%= submit_tag( "Remove Team", class: "btn btn-danger" ) %>
                  <% end %>
                <!-- Admins can remove teams from events -->
                <% end %>
              <% end %>
            <% else %>
              Wins: 0<br/>
              Losses: 0<br/>
              Points: 0
            <% end %>
          </div>
          
        </div>
        <br/><br/>
      <% end %>
    </div>
  </div> <!-- /top row well -->
    <div class = 'row well text-center'>
      <h2>Matches</h2>
      <% @match_list.each_with_index do |round, i| %>
        <% if round[0] %>
        <div class = "col-md-4">
          <h3>Round <%= i + 1 %></h3>
          <% round.each do |m| %>
            <div class = "col-sm-5">
              <%= @teams.find{|t| t.id == m.home_team}.name %>
            </div>
            <div class = "col-sm-2">V</div>
            <div class = "col-sm-5">
              <%= @teams.find{|t| t.id == m.away_team}.name %>
            </div>
          </br>
          <% end %>
        </div>
        <% end %>
      <% end %>
    </div> <!-- /matches row well -->
</div>

<div id="match_modal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Create Match</h4>
      </div>
      <div class="modal-body">
        <%= render 'form' %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>